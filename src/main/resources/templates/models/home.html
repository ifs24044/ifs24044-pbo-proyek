<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/base}"
  lang="id"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Restaurant Menu Management</title>
    
    <th:block layout:fragment="others-css">
      <style>
        /* --- KONFIGURASI WARNA --- */
        :root {
            --purple-primary: #6f42c1;
            --purple-gradient: linear-gradient(135deg, #6610f2 0%, #d63384 100%);
            --blue-gradient: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%); 
        }

        /* --- HERO BANNER (STYLE: WHITE BACKGROUND + BORDER LINE) --- */
        .hero-banner {
            background: #ffffff; /* Background Putih */
            
            /* Border Line Ungu */
            border: 2px solid var(--purple-primary); 
            
            color: #333; /* Teks Gelap */
            
            padding: 3rem 2.5rem;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            
            /* Shadow sangat tipis */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.03); 
            margin-bottom: 25px;
        }

        .wave-emoji {
            display: inline-block;
            animation: wave-animation 2.5s infinite;
            transform-origin: 70% 70%;
        }
        @keyframes wave-animation {
            0% { transform: rotate( 0.0deg) }
            10% { transform: rotate(14.0deg) }
            20% { transform: rotate(-8.0deg) }
            30% { transform: rotate(14.0deg) }
            40% { transform: rotate(-4.0deg) }
            50% { transform: rotate(10.0deg) }
            60% { transform: rotate( 0.0deg) }
            100% { transform: rotate( 0.0deg) }
        }

        /* --- CSS TOMBOL --- */
        .btn-soft-primary { background-color: rgba(13, 110, 253, 0.1); color: #0d6efd; border: none; font-weight: 600; transition: all 0.3s ease; }
        .btn-soft-primary:hover { background-color: #0d6efd; color: white; transform: translateY(-2px); }
        
        .btn-soft-warning { background-color: rgba(255, 193, 7, 0.15); color: #d68910; border: none; font-weight: 600; transition: all 0.3s ease; }
        .btn-soft-warning:hover { background-color: #ffc107; color: white; transform: translateY(-2px); }
        
        .btn-soft-danger { background-color: rgba(220, 53, 69, 0.1); color: #dc3545; border: none; font-weight: 600; transition: all 0.3s ease; }
        .btn-soft-danger:hover { background-color: #dc3545; color: white; transform: translateY(-2px); }

        .btn-purple {
            background: var(--purple-gradient);
            border: none;
            color: #ffffff !important;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-purple:hover { opacity: 0.9; color: #ffffff; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(111, 66, 193, 0.3); }

        .btn-gradient-blue {
            background: var(--blue-gradient);
            border: none;
            color: #ffffff !important;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-gradient-blue:hover { opacity: 0.9; color: #ffffff; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 114, 255, 0.3); }

        /* --- CARD & FOTO --- */
        .menu-card-custom {
            border: 1px solid #e2e8f0; 
            border-radius: 15px; 
            background: #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            overflow: hidden; 
        }

        .menu-card-custom:hover {
            transform: translateY(-5px); 
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            border-color: #cbd5e1; 
        }

        .card-img-wrapper {
            position: relative;
            height: 260px; 
            overflow: hidden;
            background-color: #f8f9fa;
        }

        .card-img-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            object-position: center center;
            transition: transform 0.5s ease;
        }

        .menu-card-custom:hover .card-img-wrapper img {
            transform: scale(1.08);
        }

        .badge-category {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 0.8rem;
            padding: 6px 12px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 2;
        }
      </style>
    </th:block>
  </head>
  <body>
    <div layout:fragment="content" class="mt-3">
      
      <!-- Container Utama -->
      <div class="card shadow-sm border-0 rounded-3">
        
        <div class="card-body p-4">
            
          <!-- HERO BANNER (KEMBALI KE STYLE BORDER LINE) -->
          <div class="hero-banner">
            <div class="d-flex justify-content-between align-items-center position-relative z-1">
                <div>
                    <!-- Teks Hitam (text-dark) -->
                    <h2 class="mb-2 fw-bold display-6 text-dark">
                        <span id="greetingText">Halo</span>, 
                        <span>[[${auth.name}]]</span>! <span class="wave-emoji">üëã</span>
                    </h2>
                    <!-- Teks Abu-abu (text-muted) -->
                    <p class="mb-0 text-muted fs-5">
                        Kelola menu restoran Anda dengan mudah dan cepat.
                    </p>
                </div>
                <div>
                    <!-- Tombol Outline Merah -->
                    <a th:href="@{/auth/logout}" class="btn btn-outline-danger rounded-pill px-4 py-2 fw-bold">
                        Keluar
                    </a>
                </div>
            </div>
          </div>

          <!-- Header Menu & Tombol -->
          <div class="d-flex mb-4 align-items-center flex-wrap gap-2 mt-2">
            <div class="flex-fill">
              <h3 class="mb-0 fw-bold text-dark">üìã Daftar Menu</h3>
            </div>
            
            <div class="d-flex gap-2">
              <a th:href="@{/menu-items/chart}" 
                 class="btn btn-gradient-blue d-inline-flex align-items-center justify-content-center gap-2 shadow-sm px-3 py-2">
                <span style="font-size: 1.1em;"></span> 
                <span>Lihat Statistik</span>
              </a>

              <button
                class="btn btn-purple d-inline-flex align-items-center justify-content-center gap-2 shadow-sm px-3 py-2"
                data-bs-toggle="modal"
                data-bs-target="#addMenuModal"
              >
                <i class="bi bi-plus-lg" style="font-size: 1.2em; -webkit-text-stroke: 1px;"></i>
                <span>Tambah Menu</span>
              </button>
            </div>
          </div>

          <!-- Filter kategori -->
          <div class="mb-4">
            <div class="btn-group w-100 w-md-auto shadow-sm" role="group">
              <a th:href="@{/}" class="btn btn-outline-primary">Semua</a>
              <a th:href="@{/(category='Appetizer')}" class="btn btn-outline-primary">Appetizer</a>
              <a th:href="@{/(category='Main Course')}" class="btn btn-outline-primary">Main Course</a>
              <a th:href="@{/(category='Dessert')}" class="btn btn-outline-primary">Dessert</a>
              <a th:href="@{/(category='Beverage')}" class="btn btn-outline-primary">Beverage</a>
            </div>
          </div>

          <!-- PESAN JIKA MENU KOSONG -->
          <div th:if="${#lists.isEmpty(menuItems)}" class="text-center py-5 bg-light rounded-3 border border-dashed">
            <div class="text-muted">
              <h1 class="display-4 mb-3">üçΩÔ∏è</h1>
              <h5>Belum ada menu yang tersedia</h5>
              <p>Klik tombol "Tambah Menu" di atas untuk menambahkan menu baru</p>
            </div>
          </div>

          <!-- GRID MENU -->
          <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" th:unless="${#lists.isEmpty(menuItems)}">
            <div class="col" th:each="menu : ${menuItems}">
              
              <!-- CARD -->
              <div class="card h-100 menu-card-custom">
                
                <!-- Wrapper Gambar -->
                <div class="card-img-wrapper">
                  <img
                    th:if="${menu.imageUrl != null}"
                    th:src="@{/menu-items/image/{filename}(filename=${menu.imageUrl})}"
                    alt="Menu Image"
                  />
                  <div
                    th:unless="${menu.imageUrl != null}"
                    class="d-flex align-items-center justify-content-center h-100 bg-secondary text-white"
                  >
                    <span class="fs-1">üçΩÔ∏è</span>
                  </div>
                  
                  <span class="badge bg-primary badge-category" 
                        th:text="${menu.category}">
                  </span>
                </div>

                <div class="card-body d-flex flex-column p-4">
                  <!-- Nama & Status -->
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <h5 class="card-title fw-bold mb-0 text-truncate" th:text="${menu.name}" th:title="${menu.name}"></h5>
                    <span th:if="${menu.isAvailable}" class="badge bg-success rounded-pill align-self-center">Tersedia</span>
                    <span th:unless="${menu.isAvailable}" class="badge bg-danger rounded-pill align-self-center">Habis</span>
                  </div>

                  <!-- Harga -->
                  <h5 class="text-primary fw-bold mb-3" 
                      th:text="'Rp ' + ${#numbers.formatDecimal(menu.price, 0, 'COMMA', 0, 'POINT')}">
                  </h5>
                  
                  <!-- Deskripsi -->
                  <p class="card-text text-muted small flex-grow-1" 
                     th:text="${menu.description} ?: 'Tidak ada deskripsi'">
                  </p>

                  <!-- Info Waktu & Kalori -->
                  <div class="d-flex justify-content-between text-muted small mb-3 border-top pt-3">
                    <span>
                      ‚è±Ô∏è <span th:text="${menu.preparationTime} + ' min'"></span>
                    </span>
                    <span>
                      üî• 
                      <span th:if="${menu.calories != null}" th:text="${menu.calories} + ' kcal'"></span>
                      <span th:unless="${menu.calories != null}">-</span>
                    </span>
                  </div>

                  <!-- TOMBOL AKSI -->
                  <div class="d-grid gap-2 d-flex justify-content-between">
                     <a th:href="@{/menu-items/{menuId}(menuId=${menu.id})}" 
                        class="btn btn-sm btn-soft-primary flex-fill">
                        Detail
                     </a>
                     
                     <button
                        th:id="|editMenuButton_${menu.id}|"
                        class="btn btn-sm btn-soft-warning flex-fill edit-menu-btn"
                        th:data-id="${menu.id}"
                        th:data-name="${menu.name}"
                        th:data-category="${menu.category}"
                        th:data-price="${menu.price}"
                        th:data-description="${menu.description}"
                        th:data-preparation-time="${menu.preparationTime}"
                        th:data-calories="${menu.calories}"
                        th:data-is-available="${menu.isAvailable}"
                     >
                        Edit
                     </button>
                     
                     <button
                        th:id="|deleteMenuButton_${menu.id}|"
                        th:attr="onclick=|prepareDeleteMenu('${menu.id}', '${menu.name}')|"
                        class="btn btn-sm btn-soft-danger flex-fill"
                     >
                        Hapus
                     </button>
                  </div>
                </div>
              </div>
              <!-- END CARD -->

            </div>
          </div>

        </div>
      </div>

      <!-- Modals -->
      <div th:replace="~{pages/menu-items/add :: addMenuModal}"></div>
      <div th:replace="~{pages/menu-items/edit :: editMenuModal}"></div>
      <div th:replace="~{pages/menu-items/delete :: deleteMenuModal}"></div>
    </div>

    <!-- Scripts -->
    <script layout:fragment="others-js">
      document.addEventListener("DOMContentLoaded", function() {
        const hour = new Date().getHours();
        const greetingElement = document.getElementById("greetingText");
        if(greetingElement) {
            let greeting = "Halo";
            if (hour >= 4 && hour < 11) greeting = "Selamat Pagi";
            else if (hour >= 11 && hour < 15) greeting = "Selamat Siang";
            else if (hour >= 15 && hour < 18) greeting = "Selamat Sore";
            else greeting = "Selamat Malam";
            greetingElement.innerText = greeting;
        }

        document.querySelectorAll('.edit-menu-btn').forEach(button => {
          button.addEventListener('click', function() {
            const id = this.dataset.id;
            const name = this.dataset.name;
            const category = this.dataset.category;
            const price = this.dataset.price;
            const description = this.dataset.description || '';
            const preparationTime = this.dataset.preparationTime;
            const calories = this.dataset.calories;
            const isAvailable = this.dataset.isAvailable === 'true';
            
            document.getElementById("editMenuId").value = id;
            document.getElementById("editMenuName").value = name;
            document.getElementById("editMenuCategory").value = category;
            document.getElementById("editMenuPrice").value = price;
            document.getElementById("editMenuDescription").value = description;
            document.getElementById("editMenuPreparationTime").value = preparationTime;
            document.getElementById("editMenuCalories").value = (calories !== null && calories !== 'null' && calories !== '') ? calories : '';
            document.getElementById("editMenuIsAvailable").value = isAvailable ? "true" : "false";

            var editModal = new bootstrap.Modal(document.getElementById("editMenuModal"));
            editModal.show();
          });
        });
      });

      function prepareDeleteMenu(id, name) {
        document.getElementById("deleteMenuId").value = id;
        document.getElementById("deleteMenuName").innerText = name;
        var deleteModal = new bootstrap.Modal(document.getElementById("deleteMenuModal"));
        deleteModal.show();
      }

      document.addEventListener("DOMContentLoaded", function () {
        var addMenuModalOpen = "[[${addMenuModalOpen}]]" === "true";
        if (addMenuModalOpen) {
          var addModal = new bootstrap.Modal(document.getElementById("addMenuModal"));
          addModal.show();
        }

        var editMenuModalOpen = "[[${editMenuModalOpen}]]" === "true";
        if (editMenuModalOpen) {
          const editMenuModalId = "[[${editMenuModalId}]]";
          const buttonEdit = document.getElementById(`editMenuButton_${editMenuModalId}`);
          if (buttonEdit) { buttonEdit.click(); }
        }

        var deleteMenuModalOpen = "[[${deleteMenuModalOpen}]]" === "true";
        if (deleteMenuModalOpen) {
          const deleteMenuModalId = "[[${deleteMenuModalId}]]";
          const buttonDelete = document.getElementById(`deleteMenuButton_${deleteMenuModalId}`);
          if (buttonDelete) { buttonDelete.click(); }
        }
      });
    </script>
  </body>
</html>